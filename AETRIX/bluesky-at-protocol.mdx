---
title: 'Bluesky 和 AT 协议: 可用的去中心化社交媒体'
description: '探索Bluesky和AT协议如何通过去中心化架构重塑社交媒体体验'
icon: 'network-wired'
---

<div className="text-sm text-gray-500 mb-4">
  作者：马丁·克莱普曼等 | 发布日期：2024年10月16日
</div>

# Bluesky 和 AT 协议: 可用的去中心化社交媒体

**马丁·克莱普曼**  
martin.kleppmann@cst.cam.ac.uk  
剑桥大学  
英国剑桥

**保罗·弗雷泽**  
paul@blueskyweb.xyz  
蓝天社交 PBC  
美国华盛顿州西雅图

**杰克·戈尔德**  
jake@blueskyweb.xyz  
Bluesky Social PBC  
美国加利福尼亚州山景城

**杰伊·格雷伯**  
jay@blueskyweb.xyz  
蓝天社交 PBC  
美国华盛顿州西雅图

**丹尼尔·霍姆格伦**  
daniel@blueskyweb.xyz  
Bluesky Social PBC  
美国密苏里州斯普林菲尔德

**德文·艾薇**  
devin@blueskyweb.xyz  
Bluesky Social PBC  
美国马萨诸塞州剑桥市

**杰罗米·约翰逊**  
why@blueskyweb.xyz  
蓝天社交 PBC  
美国华盛顿州西雅图

**布莱恩·纽博尔德**  
bryan@blueskyweb.xyz  
Bluesky Social PBC  
美国华盛顿州西雅图

**贾兹·沃尔珀特**  
jaz@blueskyweb.xyz  
Bluesky Social PBC  
美国加利福尼亚州旧金山

## 摘要

Bluesky 是一个建立在 AT 协议之上的新社交网络，AT 协议是公共社交媒体的去中心化基础。它于 2023 年 2 月推出私人测试版，到 2024 年 10 月已增长到超过 1000 万注册用户。在本文中，我们介绍了 Bluesky 的架构和 AT 协议，并解释了 Bluesky 的技术设计如何受到我们的目标的影响：通过为系统的每个部分提供多个可互作的提供者来实现去中心化；使用户能够方便地更换提供商；为用户提供对他们看到的代理权；并提供简单的用户体验，不会因系统的去中心化性质而给用户带来复杂性。该系统的开放性允许任何人为内容审核和社区管理做出贡献，我们邀请研究社区将 Bluesky 用作社交媒体审核新方法的数据集和试验场。

**关键字**  
社交网络；分散；联邦

## 1. 引言

在过去的二十年里，社交媒体已经演变成一个"数字城市广场"和公民生活的基石。当社交媒体服务完全由一家公司控制时，它可能会根据其领导人的心血来潮改变其政策。它的作是不透明的（例如，关于向用户推荐哪些内容），并且其用户对其用户体验缺乏代理权。因此，人们对去中心化社交网络的兴趣越来越大，其中围绕 ActivityPub 协议和 Mastodon 软件的 fediverse 可能是最著名的。

然而，去中心化也带来了新的挑战。例如，在 Mastodon 的情况下，用户在创建帐户时需要选择一个服务器。此选项非常重要，因为服务器名称将成为用户名的一部分；迁移到另一台服务器意味着更改用户名，并且在此类迁移期间保留自己的关注者需要旧服务器的合作。如果服务器在没有警告的情况下关闭，则无法恢复该服务器上的账户 - 这对于志愿者运行的服务器来说是一个特别的风险。原则上，用户可以托管自己的服务器，但只有一小部分社交媒体用户同时具备技术技能和这样做的意愿。

Mastodon 中服务器之间的区别为用户带来了复杂性，这在集中式服务中是不存在的。例如，与在另一台服务器上查看同一线程相比，用户在一台服务器的 Web 界面中查看回复线程可能会看到一组不同的回复，因为服务器只显示它知道的那些回复。再举一个例子，在另一台服务器上查看帐户的 Web 配置文件时，单击"follow"按钮不仅仅是关注该帐户；相反，用户需要输入自己服务器的主机名，并被重定向到其主服务器上的 URL，然后才能关注该帐户。在我们看来，让用户承担由联合架构引起的如此复杂是不可取的。

在本文中，我们介绍了 AT 协议 (atproto)，一个去中心化的社交网络基础，以及 Bluesky，一个基于该协议构建的 Twitter 风格的微博应用程序。atproto 和 Bluesky 的核心设计目标是实现与中心化服务相同或更好质量的用户体验，同时在技术水平。AT 协议的设计使得系统的每个部分都可以有多个竞争运营商提供可互作的服务，从而可以轻松切换提供商。

仅靠去中心化无法解决社交媒体的一些最棘手的问题，例如错误信息、骚扰和仇恨言论。然而，通过向公众开放服务的内部结构，去中心化可以为解决这些问题提供一个方法市场。例如，Bluesky 允许任何人运行审核服务，这些服务可以主观地决定选择理想的内容或标记不需要的内容，用户可以选择他们想要订阅的审核服务。审核服务与托管服务提供商解耦，使用户可以轻松切换审核服务，直到找到符合他们偏好的服务。我们希望这种架构的开放性使社区能够开发自己的方法来管理有问题的内容，而不受托管提供商实施的方法的影响。

## 2. 蓝天社交应用

Bluesky 是一个 Twitter/X 风格的微博应用程序。"官方"客户端应用程序可在 iOS、Android 和 Web 上使用；还有几个独立开发的客户端应用程序可用，例如 Graysky 和 deck.blue。用户可以发布包含最多 300 个字符的文本、最多 4 张图像和短视频的公开帖子。他们可以通过回复、转发或点赞来与帖子互动，并且可以关注其他用户。默认情况下，用户有两个源：一个按时间倒序显示关注帐户的帖子，另一个推荐网络上的热门内容。用户还可以从许多显示各种主题内容的替代源中进行选择。

Bluesky 于 2023 年 2 月推出了仅限邀请的测试版，并在接下来的 20 个月内增长到超过 1000 万注册用户。Bluesky Social PBC（一家公益公司）开发官方客户端应用程序并运营核心服务；客户端和几个服务器端组件是开源的，在 MIT 和 Apache 2.0 许可证下获得双重许可。他们使用的协议由开放规范定义。该系统的几个部分，如饲料生成器和替代客户，是由独立的第三方开发和运营的。

### 2.1 审核功能

Bluesky 目前有以下审核机制（其他机制正在讨论中）：

**内容过滤：** 自动化系统会标记可能存在问题的内容（例如垃圾邮件、性或暴力图像），并且应用程序的首选项允许用户选择是显示还是隐藏每个类别中的内容。

**静音：** 用户可以将特定帐户或线程静音，这会在自己的源和通知中隐藏静音的内容。该内容继续对其他用户可见，并且目标不知道他们已被静音。用户还可以发布帐户的静音列表，其他用户可以订阅该列表，这与他们单独将列表中的所有帐户静音的效果相同。

**阻止：** 一个用户可以阻止另一个用户，除了双向静音外，还可以阻止这些帐户之间的所有未来交互（例如提及、回复或转发）。与静音列表类似，用户也可以发布帐户列表，其他用户可以通过订阅来阻止该列表上的所有帐户。

**交互门控：** 发布帖子的用户可以限制允许谁回复它（任何人、他们关注的任何人、帖子中提到的任何人和/或特定帐户列表中的任何人）。原始发帖者还可以隐藏回复，以便访问，但默认情况下不显示。

**引用分离：** 当帖子被其他用户的帖子引用时，原始帖子的作者可以将其与引用帖子分离。这降低了通过狗堆骚扰的风险。

**删除：** 用户可以向审核服务报告违反服务条款的内容。服务运营商可以关闭违规媒体、帖子或帐户。

**自定义源：** 虽然上述机制提供了负面审核（帮助用户避免他们不想看到的内容），但源生成器可以主动选择高质量的内容。

### 2.2 用户句柄

与 Twitter/X 一样，Bluesky 用户有两个名称：显示名称几乎可以是任何字符串，句柄需要唯一标识用户。以 @ 符号为前缀的 handle 用于在帖子中提及其他用户。

句柄的唯一性需求在去中心化系统中带来了挑战，因为它需要一个权限来确定哪个句柄分配给哪个用户。Mastodon 的方法是在 handle 中包含服务器名称，这使得移动到另一个服务器变得困难。另一种方法是使用基于区块链的命名系统，例如以太坊名称系统 (ENS)；这样做的缺点是需要用户购买加密货币才能创建帐户，我们希望避免这种情况。

相反，Bluesky 和 atproto 使用 DNS 域名作为句柄。用户可以免费注册 .bsky.social 的子域。如果用户已经拥有域名，他们可以通过添加 DNS 记录或在该域上的 /.well-known/ HTTPS URL 下托管文件来将其声明为他们的 Bluesky 句柄。用户还可以通过与域名注册商合作在 Bluesky 中购买新域名。域名有以下几个优点：

* 我们利用 ICANN、注册商和域名服务器的现有基础设施，包括商标争议解决程序等。
* 域名即使在非技术用户中也是一个众所周知的概念，而且它们简短明了。
* 用户可以在不更改其句柄的情况下移动到其他服务器。
* 用户无需托管自己的服务器即可使用自己的域名；他们只需要维护 DNS 记录。
* 对于已经拥有知名域名的组织和个人，使用该名称使用户可以轻松检查他们的 Bluesky 帐户是否为真实帐户。例如，《纽约时报》的用户名是 @nytimes.com。
* 组织可以通过授予其员工组织主域名的子域（类似于机构电子邮件地址）来允许其员工证明其隶属关系。例如，记者的用户名可能表明他们位于特定新闻机构。
* 提供免费子域的成本非常低。

### 2.3 自定义源和算法选择

一些去中心化社交网络仅提供用户关注的帐户的帖子的倒序时间提要 —— 这是对主流社交网络使用的不透明推荐算法的强烈反对。例如，Mastodon 宣传自己"没有算法或广告来浪费你的时间"。

我们认为，问题不在于算法本身，而在于集中控制的、不透明的算法，这些算法消除了用户代理并将用户参与度置于其他一切之上，例如通过推广有争议的帖子。好的推荐算法可以帮助用户发现与他们相关的内容并找到要关注的新帐户 —————— 对于尚未关注许多帐户的新用户尤其重要。它们还有助于显示有关特定主题的内容，而关注用户意味着看到他们的所有帖子，这些帖子可能是关于多个主题的混合，不一定所有关注者都感兴趣。我们的目标是提供一个开放和多样化的算法市场，社区可以在其中调整系统以适应他们的需求，并且用户对如何花费时间和注意力有更多的代理权。

Bluesky Social PBC 提供了自己的 Feed 算法选择，还允许任何人创建自己的 Feed 生成器。已经创建了数以万计的自定义源。源生成器可以使用任意条件来选择其内容。例如，它可能会使用手动策划的帐户列表，并从包含特定主题标签或表情符号字符的帐户中选择帖子。使用机器学习算法同样是可能的。

## 3. AT 协议架构

Bluesky 是具有第 2 节中解释的功能的社交应用程序，而 AT 协议是底层的去中心化基础。我们之所以保持这种分离，是因为 AT 协议旨在支持多种社交模式，而不仅仅是 Bluesky。例如，除了 Twitter 风格的微博应用程序外，atproto 还可用于实现 Reddit 风格的论坛、带有评论的长篇博客或特定领域的社交应用程序，例如链接共享或书评。相同的用户身份、社交图和用户数据存储服务器可以在所有这些应用程序之间共享。

社交模式由词典定义，词典指定了数据的模式和所涉及的请求端点。多个词典当前使用的词语是：例如，com.atproto 词典定义了用户身份等核心 AT 协议概念，app.bsky 词典定义了微博模式，tools.ozone 词典支持审核作。任何人都可以定义一个新的词典，允许新的社交模式与共享基础设施上的 Bluesky 社交应用程序共存。词典的目的是提供文档，允许在应用程序中生成代码和进行类型检查，并促进架构演变以实现长期兼容性和互作性。

新社交模式的最大限制是 atproto 目前是为用户想要公开的内容而设计的。特别是，Bluesky 用户个人资料、帖子、关注和点赞都是公开的。阻止作目前也是公开的；我们正在研究将这些设为私有的机制。目前只有一小部分用户状态是私有的：被静音的帐户和话题、通知及其未读状态，以及用户首选项（如内容过滤设置）。私人通信（私信）目前由 Bluesky Social PBC 运行的集中式服务处理；我们计划在未来分散此组件。

### 3.1 用户数据存储库

用户希望发布的所有数据都将添加到其存储库中，该存储库存储记录集合。每当用户执行某些作（发布帖子、点赞其他用户的帖子、关注其他用户等）时，该作都会成为其存储库中的记录。记录以 DAG-CBOR 编码，这是 CBOR 的一种限制形式，是一种紧凑的二进制数据格式。记录的架构由词典定义，存储库可能包含来自多个不同词典的记录的混合，代表不同社交模式下的用户作。媒体文件（例如图像）存储在用户存储库的外部，但由存储库中记录的 CID（本质上是加密哈希）引用。同样，对另一个存储库中记录的引用（例如，识别被点赞的帖子）也包括其 CID。

每个用户帐户都有一个存储库，其中包含他们曾经执行过的所有作，不包括他们已明确删除的任何记录。个人数据服务器 (PDS) 托管用户的存储库，并将其作为 Web 服务公开提供。

用户仅更新自己的仓库；例如，如果用户 A 关注用户 B，则仅会导致用户 A 的仓库中出现关注记录，而不会更改 B 的仓库。要查找用户 B 的所有关注者，需要为所有存储库的内容编制索引。此设计决策类似于超链接在 Web 上的工作方式：很容易找到位于给定 URL 的网页的所有出站链接，但要找到指向页面的所有入站链接，需要整个 Web 的索引，该索引由 Web 搜索引擎维护。

atproto 中的 AT 代表 Authenticated Transfer，它反映了存储库经过加密身份验证的事实。存储库中的记录被组织成 Merkle 搜索树 (MST)，这是一种保持平衡的 Merkle 树，即使以任意顺序插入或删除记录也是如此。每次更改存储库后，都会对 MST 的根哈希进行签名；此签名的公共验证密钥是用户身份的一部分。这样可以有效地进行加密证明，即给定记录显示在给定用户的存储库中。此外，当用户更新或删除记录时，MST 会启用旧记录不再出现在存储库中的证明。

### 3.2 个人数据服务器 (PDS)

PDS 存储存储库和关联的媒体文件，并允许任何人通过 HTTP API 查询它托管的数据。此外，PDS 通过 WebSocket 为其托管的存储库提供实时更新流。索引器订阅此流，以便以低延迟查找新的或删除的记录（帖子、点赞、关注等）。

为少数用户托管 PDS 只需要少量的计算资源，即使这些用户拥有大量关注者。因此，希望自托管自己的 PDS 的用户可以在云中的廉价虚拟机上进行，甚至可以在连接到家庭互联网路由器的 Raspberry Pi 上进行。但是，我们预计大多数用户将在由专业托管服务提供商（Bluesky Social PBC 或其他公司）运营的共享 PDS 上注册一个帐户。

与选择 Mastodon 服务器相比，用户对 PDS 托管服务提供商的选择相当无关紧要。PDS URL 是系统内部的，通常对用户不可见。两个用户是位于同一 PDS 上还是不同 PDS 上没有区别，因为用户之间的交互在任何情况下都通过索引基础设施进行。用户可以将其存储库和媒体文件复制到新的 PDS，并将其帐户指向新的 PDS URL，从而从一个 PDS 迁移到另一个 PDS。即使 PDS 在没有警告的情况下关闭，用户可以将其仓库的备份上传到新的 PDS，从而恢复其帐户，而不会丢失任何帖子或社交图谱。

PDS 运营商通常会通过删除其服务器上托管的任何非法内容来执行一些基本的审核。然而，在 Mastodon 中，PDS 级别的审核远不如服务器级别的审核重要，因为在 atproto 中，主要的审核角色由系统中的不同参与者承担 —————— 贴标机和饲料生成器。这允许不同的人组分别提供服务器托管和审核服务；我们相信这种分离是有价值的，因为运营服务器和管理社区需要的技能在很大程度上是不相交的。

### 3.3 索引基础设施

在 Web 上，搜索引擎对网站进行爬网和索引，然后搜索引擎提供 Web 范围的搜索和发现功能，而这些功能是网站本身无法提供的。AT 协议的灵感来自这种架构：PDS 托管的存储库类似于网站，索引基础设施类似于搜索引擎。用户存储库是主要数据（"事实来源"），索引派生自存储库的内容。

在撰写本文时，Bluesky 的大部分索引基础设施由 Bluesky Social PBC 运营。但是，该公司没有任何特权访问权限：由于存储库是公共的，因此任何人都可以使用与我们的系统相同的协议对其进行抓取和索引。如果 Bluesky Social PBC 违反了用户的期望 —————— 例如，审查（从索引中省略）用户希望看到的帐户 —————— 其他方可以自由提供他们自己的索引，而这些索引不会执行此审查。客户端应用程序可以切换到从其他索引读取，甚至可以使用多个索引的组合。

2024 年 7 月（当时 Bluesky 拥有 600 万用户），可以以每月 153 美元的价格在单个服务器上维护所有用户存储库的实时副本 —————— 对于一个业余爱好项目来说很昂贵，但许多组织很容易负担得起。此数字包括存储库存储和从 PDS 获取记录的入站带宽，但不包括从该数据构建和提供摘要索引的计算资源。

由于成本较高，我们预计业余爱好者索引器将少于自托管 PDS。尽管如此，随着 Bluesky 的发展，可能会有多个专业运行的索引器用于各种目的。例如，一家对有关品牌的社交媒体活动进行情绪分析的公司可以轻松创建一个全网络索引，为其客户提供见解。Web 搜索引擎可以将 Bluesky 活动合并到他们的索引中，而 Internet Archive 等档案管理员可以为后代保留该活动。

Bluesky Social PBC 运营的索引基础设施由多个服务组成，这些服务具有用于外部服务的集成点。

**3.3.1 中继站。** 第一个组件是 Relay，它爬取所有已知 PDS 上的用户存储库，并使用它们生成的更新流。Relay 在更新时检查签名和 Merkle 树证明，并维护每个存储库的自己的副本。根据此信息，中继创建 firehose：一个聚合的更新流，每当在任何已知存储库中添加或删除记录时，都会通知订阅者。通常，与 PDS 的 WebSocket 连接为中继提供存储库更改的低延迟通知，但在网络中断的情况下，中继还可以定期重新爬取存储库，并将其与本地副本进行比较，以确定已添加或删除的记录。

消防水带是公开可用的。与直接订阅源 PDS 相比，使用 firehose 是在整个网络上构建索引的一种更简单的方法，因为 Relay 会执行一些初始数据清理（丢弃格式错误的更新、过滤掉非法内容和大量垃圾邮件）。Firehose 包括 Merkle 校样和签名以及记录，允许订阅者检查它们是否真实。

Relay 不会解释或索引存储库中的记录，而只是存储和转发它们。任何希望在 atproto 之上创建新的社交模式的开发人员都可以使用新的记录类型定义新的词典，这些记录可以存储在现有存储库中并聚合在 firehose 中，而无需对 Relay 进行任何更改。

**3.3.2 应用程序视图。** 应用程序视图是一项使用 firehose 并处理与 Bluesky 社交应用程序相关的记录（com.atproto 和 app.bsky 词典中的记录）的服务。例如，App View 会计算每个帖子的点赞数，并整理每个帖子的回复线程。App View 还维护每个用户的关注者集，并构建包含每个用户关注的帐户的帖子的时间轴。然后，它提供了一个 Web 服务，通过该服务可以查询此信息。当记录包含对图像的引用时，应用程序视图会从原始 PDS 中提取这些文件，如有必要，请调整其大小以减小文件大小，并通过内容分发网络 (CDN) 提供它们。

为了在用户的客户端应用程序中显示此信息，客户端会查询用户自己的 PDS，然后 PDS 会从 App View 中获取必要的数据。应用程序视图还负责实施审核控制：例如，如果一个用户阻止了另一个用户，并且其中一个用户的存储库包含由于阻止而不应允许的交互记录，则应用程序视图会删除该交互，以便任何人都无法在客户端应用程序中看到它。这种行为与 Twitter/X 上的屏蔽方式一致，这也是为什么屏蔽在 Bluesky 中是公共记录的原因：每个符合协议的 App View 都需要知道谁在屏蔽谁，以便执行屏蔽。如果用户对 Bluesky Social PBC 运营的 App View 所应用的审核规则不满意，第三方始终可以作替代的 App View，这些 App View 对相同的 firehose 进行索引，并以不同的方式呈现数据。

基于 atproto 构建的其他社交模式需要自己的 App View 服务，以根据需要解释和索引用户存储库中的记录。PDS 和继电器可以重复使用。

### 3.4 贴标机和饲料生成器

Relay 和 App View 旨在提供一种几乎"无主见"的服务：它们以中立的方式计算存储库的索引，而不尝试对内容进行排名或分类。但是，良好的用户体验还需要出于内容过滤（例如检测色情图片或垃圾信息）和策展（例如选择特定主题的帖子）而做出"固执己见"的判断。

AT 协议将系统的"固执己见"方面分为单独的服务：贴标机和饲料生成器。这些服务通常将 firehose 作为其输入。贴标机会生成一系列关于内容的判断（例如，"此帖子是垃圾帖子"），而 Feed 生成器会返回他们选择包含在自定义 Feed 中的帖子 ID 列表。用户可以在其客户端应用程序中选择他们想要使用的 Feed 和标记人员。标记器的输出由应用程序视图或 PDS 使用，以便应用内容过滤。对于源生成器，应用程序视图会将帖子 ID 扩展为完整帖子，然后再将其发送到订阅该源的用户的客户端应用程序。

拥有独立于 App View 的贴标机和 Feed 生成器服务具有以下几个优势：

* 任何人都可以运行此类服务，从而实现一个多元化的生态系统，其中不同的各方可能会对同一内容做出不同的判断。用户以及 App Views 和 PDS 的运营商可以决定他们想要信任谁的判断，如果当前的提供商无法满足他们的期望，他们很容易切换到替代的标签和信息源生成服务。
* 设置替代 App View 提供商变得更加容易：由于任何 App View 都可以使用来自贴标机和提要生成器的公开输出，因此每个 App View 开发自己的内容过滤基础设施的压力较小。拥有替代 App View 对于健康的去中心化市场非常重要。

馈送生成器可以使用我们的入门工具包或使用第三方服务（如 Skyfeed）来实现。

### 3.5 用户身份

atproto 中基于 DNS 的用户身份与托管和索引分离。任何拥有域名的人都可以发布子域作为 atproto 句柄，这不需要运行 PDS 或除 DNS 之外的任何其他服务。

用户名可以更改，但每个 Bluesky/atproto 帐户也都有一个不可变的唯一标识符：去中心化 ID 或 DID，它是以前缀"did:"开头的 URI。例如，当用户 A 的存储库中的记录指示 A 正在关注 B 时，该记录包含 B 的 DID；这允许用户更改其用户名，而不会影响其社交图。DID 是最新的 W3C 标准。

此外，我们希望用户能够在不更改其 DID 或句柄的情况下迁移到不同的 PDS。DID 提供了一种将 DID 解析为 DID 文档的机制，该文档是一个 JSON 文档，其中包含该 DID 标识的用户信息。在 atproto 中，DID 文档指定用户的句柄、PDS 的 URL，以及每次添加或删除记录时用于对其存储库的 Merkle 树根进行签名的公钥。要更改其句柄或 PDS，用户需要将其 DID 文档更新为新值。

要证明句柄的所有权，用户的 DID 和域名句柄之间必须有一个双向链接：

* 通过将 DID 存储在该域名上的 DNS TXT 记录中，或者通过返回 DID 以响应对该域名上 /.well-known/ URL 的 HTTPS 请求，可以建立从句柄到 DID 的链接。
* 通过将句柄包含在解析 DID 时返回的 DID 文档中，建立从 DID 到句柄的链接。

App View 会定期检查这些双向链接，如果其中任何一个链接损坏，则使句柄失效。如果 App View 是诚实的，并采取措施防止 DNS 中毒攻击（可能在可用时使用 DNSSEC），则此方法可以防止用户冒充他们不拥有的域。

**3.5.1 解析 DID 文档。** DID 规范没有直接指定将 DID 解析为 DID 文档的机制。相反，在 DID 中 did: 之后的第一个子字符串表示 DID 方法，而 DID 方法的规范定义了获取 DID 文档的协议。已经定义了数百种 DID 方法，其中许多方法依赖于特定的区块链或其他外部系统。为了避免 atproto 实现必须支持如此多的解析方法，我们的服务目前只接受基于 did:web（由 W3C 凭证社区组定义）或 did:plc（由我们为 atproto 定义）的 DID。将来可能会添加对更多 DID 方法的支持。

**did:web 方法非常简单：** did:web: 后面的 DID 部分是一个域名，DID 文档是通过向该域名上的 /.well-known/ URL 发出 HTTPS 请求来解析的。因此，did:web 身份的安全性假定该域的 Web 托管提供商是受信任的，并且还依赖于信任可能验证 HTTPS 请求的 TLS 证书颁发机构。

因此，did:web 身份类似于域名句柄，不同之处在于名称无法更改，因为 DID 是不可变的标识符。这使得 did:web 适配于已经与特定域名紧密关联的组织的身份。对于大多数用户来说，did:plc 更合适，因为它只使用域名作为可以更改的句柄。

**3.5.2 did:plc DID 方法。** 当用户在 Bluesky 社交应用上创建帐户时，默认情况下会为其分配一个 did:plc:eclio37ymobqex2ncko63h4r 形式的 DID，其中前缀 did:plc: 后面的字符串是初始 DID 文档的 SHA256 哈希值，截断为 120 位并使用 base32 编码。这种形式的 DID 可以通过查询 https://plc.directory/ 的服务器来解析为对应的 DID 文档，该服务器目前由 Bluesky Social PBC 运营；将来，我们计划建立一个由独立运营商组成的联盟，共同提供 PLC 目录服务。

PLC 目录服务器扮演着类似于 DNS 根服务器的权威角色，但由于 PLC DID 文档是自我认证的，因此它大多不受信任。如果 DID 文档自初始创建以来未更改，则通过重新计算其哈希值，可以轻松验证 DID 是否已正确解析为 DID 文档。为了支持对 DID 文档的更改，用户的 DID 文档的初始版本包含一个公钥，该公钥有权对 DID 文档的新版本进行签名。DID 文档的任何新版本只有在由先前版本中的密钥签名时才有效。该目录返回给定 DID 的所有 DID 文档版本，允许任何人检查签名链。

如果目录服务器是恶意的，它将无法修改任何 DID 文档 - 它只能在响应中省略有效的 DID 文档版本，或者根本无法响应。此外，如果 DID 文档历史记录中存在一个分支，使得某些 DID 的两个正确签名的后续版本 document 存在，则目录服务器可以选择提供这些 fork 中的哪一个。为了减轻此类攻击，我们预计 PLC 目录的未来版本将使用类似于证书透明度 的仅附加透明日志。

**3.5.3 身份验证。** 原则上，用于签名存储库更新和 DID 文档更新的加密密钥可以直接保存在用户的设备上，例如使用加密货币钱包，以最大限度地减少对服务器的信任。但是，我们认为这种手动密钥管理并不适合大多数用户，因为密钥泄露或丢失的风险很大。

因此，Bluesky PDS 代表用户保管这些签名密钥，用户通过用户名和密码登录他们的家庭 PDS。这为用户提供了熟悉的用户体验，并启用了标准功能，例如通过电子邮件重置密码。AT 协议不对 PDS 如何验证其用户做出任何假设；其他 PDS 作员可以自由使用不同的方法，包括用户管理的密钥。

## 4. 相关工作

其他几个去中心化社交网络正在开发中。我们相信没有单一的最佳设计：不同的系统会做出不同的权衡，因此适用于不同的目的。

Bluesky 和 AT 协议旨在通过提供整个网络的全局视图、使审核成为首要关注点以及拥有轻量级且易于使用的客户端来提供良好的用户体验。例如，对话线程包括所有回复（除非被审核删除），而不管它们在哪个服务器上发布。为了实现这个目标，我们依赖于一个比其他一些设计更集中的索引基础设施。但是，我们强调可以有多个竞争索引器，第三方客户端应用可以自由显示来自他们想要的任何索引器的数据。

2021 年，我们团队的一些人发表了一篇关于去中心化社交生态系统的评论。在本节中，我们总结了此后发生的一些最新进展，并参考综述以更全面地比较协议和系统。

许多去中心化社交网络项目都有共同的想法。例如，使用 DNS 域名作为用户名的想法也出现在 Nostr 中。atproto PDS 与 Git 存储库托管（例如 GitHub/Gitlab）或 Solid pod 有相似之处。

### 4.1 屁股 (Secure Scuttlebutt)

Secure Scuttlebutt (SSB) 是一种点对点社交网络协议；Manyverse 是一个基于 SSB 协议构建的社交应用程序。它可以选择使用称为 pubs 的中继服务器来存储来自离线对等节点的消息，并启用用户发现。客户端软件从用户明确关注的帐户以及后跟关注帐户的帐户（默认最多三个跃点）下载 Feed。这可能需要客户端上的大量存储和带宽。

不会显示来自三级网络之外的用户的任何消息，这实际上将可以提及或回复用户的用户集限制在三级网络内。这个深思熟虑的设计决定旨在通过优先考虑已经认识的人之间的对话来减少审核问题。相比之下，Bluesky/atproto 旨在允许任何人与其他人交谈。这需要更明确的审核来管理不需要的内容，但我们相信它也能实现偶然性，并且是任何"数字城市广场"的先决条件。

由于 SSB 建立在仅附加日志和 gossip 复制之上，因此一旦发布内容，就无法删除它。用户身份与用户设备上的加密密钥相关联，需要手动管理密钥才能移动到另一台设备。无法从多个设备发布，因为在设备之间共享相同的密钥可能会使帐户无法恢复。SSB 的后继协议 PZP 旨在解决这些问题。

### 4.2 诺斯特 (Nostr)

Nostr 也是作为 SSB 的修订版开始的，用单独的签名消息替换了仅附加日志。它更依赖于中继服务器而不是点对点通信：客户端在他们选择的中继上发布和获取消息，并且中继之间没有联合。该协议故意简单，它优先考虑抗审查而不是审核：中继可以阻止用户，但用户始终可以移动到新的中继，并同时使用多个中继。通信（例如回复线程）只能在至少有一个共同中继的用户之间进行。尽管某些服务为整个 Nostr 网络编制索引，但这些索引不用于用户到用户的交互。因此，谁将看到哪条消息是不可预测的。Nostr 的创建者写道："没有任何保证 [...] 要使用 Nostr，必须接受固有的混乱"。在 Nostr 中，密钥管理是手动的，密钥轮换的工具仍在讨论中。

### 4.3 Farcaster 和基于区块链的系统

Farcaster 与 Bluesky/atproto 有一些架构上的相似之处，尽管它是独立开发的。它有称为 hubs 的存储服务器，它存储整个网络的状态类似于 atproto Relay，并且它有一个托管应用服务器的概念，类似于我们的 App View。Farcaster 用户 ID 类似于我们的 DID，它们使用 Ethereum Optimism 区块链上的智能合约映射到公钥，该智能合约在功能上类似于我们的 PLC 目录。用户名可以是 ENS 名称，也可以是由 Farcaster 集中管理的链下命名空间中的名称，类似于 Bluesky 中的 .bsky.social 子域。

区别在于 Farcaster 没有等价于 atproto 的 PDS；相反，客户端应用程序将签名消息直接发布到 Hub，而 Hub 使用 Convergent Gossip 协议同步消息。用户必须以加密货币支付才能注册他们的公钥，以及集线器数据存储（在撰写本文时，以太坊相当于 5 美元/年）；当用户超出其存储限额时，旧消息将被删除。费用目前由 Farcaster 团队集中收取。相比之下，AT 协议没有指定存储限制，而是将其留给 PDS 和索引服务提供商来定义他们自己的业务模型和滥用预防策略。我们也更愿意避免对加密货币的依赖。

Lens 协议比 Farcaster 更强地基于区块链：它甚至在权益证明区块链 Polygon 上存储了大量用户作，例如帖子和关注。DSNP 采取了类似的方法。将高容量事件直接放置在区块链的每用户成本比 Atproto 高几个数量级，并且随着用户数量的增长，可能会遇到可扩展性限制。Lens 正在采用第 3 层区块链，该区块链提供更好的可扩展性和更低的成本，但安全性较弱。将社交帐户链接到加密货币钱包和 NFT 使用户能够通过他们的内容获利，但这不是 atproto 的目标。

### 4.4 ActivityPub 和 Mastodon

ActivityPub 是社交网络的 W3C 标准，而 Mastodon 是其最流行的实现。Mastodon 赋予服务器管理员很多权力：例如，服务器管理员可以选择阻止另一台服务器，从而阻止这些服务器上的用户之间的所有通信。由于移动到另一个服务器具有侵入性，因此存在一定程度的服务器锁定：用户名更改，将帖子移动到新服务器当前需要一个实验性的命令行工具，并且其他用户对这些帖子的回复会丢失。如果无法访问旧服务器 - 例如，因为它的管理员在没有警告的情况下关闭了它，或者因为它的域被占用 - 用户的社交图谱就会丢失。这些风险可以通过自托管来缓解；托管提供商存在，但他们仍然需要一些专业知识和成本。AT 协议将审核和托管的角色分开，旨在在不丢失任何数据的情况下更轻松地更换提供商。

当用户 A 关注用户 B 时，A 的服务器要求 B 的服务器通过 ActivityPub 向其发送 B 未来帖子的通知。此体系结构的优点是不需要全网络索引。但是，对帖子的回复会通知原始帖子的服务器，但不一定会通知拥有原始帖子副本的每个服务器，这会导致不同服务器上的回复线程不一致。通知可以转发，但在限制中，这会导致每个服务器都有整个网络的副本，这将使运行服务器的成本很高。病毒式帖子可以产生大量来自点赞、回复和提升（转发）的人对服务器的入站请求。相比之下，Bluesky 索引基础设施也相当昂贵，但 PDS 的运行成本较低。由于用户可以独立于其索引提供商 (App View) 选择他们的审核首选项，因此我们相信，即使有少量索引提供商，生态系统也可以保持健康。

## 5. 结论

Bluesky 和 AT 协议是一种新的社交媒体方法。他们的架构基于这样一个原则，即系统的每个部分都可以由多个竞争的提供商运行，并且用户可以以最小的摩擦切换提供商（特别是，无需更改用户名，也不会丢失任何内容或社交图谱）。例如，任何人都可以编写客户端、托管 PDS、为网络编制索引或提供审核服务，所有这些服务都可以互作。尽管目前大多数 Bluesky 服务由一家公司运营，但我们仍然认为该系统是去中心化的，因为它提供了可信的出口：如果 Bluesky Social PBC 倒闭或失去用户的信任，其他提供商可以介入，使用相同的数据集和相同的协议提供等效的服务。

虽然一些去中心化系统优先考虑抗审查性，但我们认为良好的用户体验明确要求处理有问题的内容，例如骚扰和错误信息。因此，我们将审核作为与基础设施托管分开处理的首要问题，并且我们为用户提供了强大的机制来控制他们看到的内容。我们的开放式架构允许一个多元化的系统，不同的用户可以选择支持不同价值观的不同提供商，同时仍然允许他们进行通信和互作。

---

*本文采用 Creative Commons Attribution 4.0 International License 进行许可。* 